<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Prediction Result</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <style>
    body { background: #f8fafc; }
    .card { border: none; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.06); }
    .badge-model { font-size: .85rem; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row g-4">
      <div class="col-lg-4">
        <div class="card p-4">
          <h4 class="mb-3">Predicted Price</h4>
          <div class="display-5 fw-bold mb-3">{{ pred }}</div>
          <span class="badge text-bg-secondary badge-model">
            Model:
            {% if model_key == 'rf' %} Random Forest {% else %} XGBoost {% endif %}
          </span>
          <hr>
          <h6 class="text-muted mb-1">Inputs</h6>
          <ul class="list-unstyled small">
            <li><strong>State:</strong> {{ state }}</li>
            <li><strong>District:</strong> {{ district }}</li>
            <li><strong>Market:</strong> {{ market }}</li>
            <li><strong>Commodity:</strong> {{ commodity }}</li>
            <li><strong>Category:</strong> {{ comm_category }}</li>
            <li><strong>Date:</strong> {{ date_str }}</li>
          </ul>
          <a href="/" class="btn btn-outline-secondary w-100">New Prediction</a>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="card p-4">
          <h4 class="mb-3">12-Month Forecast</h4>
          <div id="forecastChart" style="height: 420px;"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const futureDates = {{ forecast_dates|tojson }};
    const futurePreds = {{ forecast_preds|tojson }};
    const currentPoint = {{ current_point|tojson }};

    const traceFuture = {
      x: futureDates,
      y: futurePreds,
      mode: 'lines+markers',
      name: 'Forecast',
      line: { width: 3 }
    };

    const traceCurrent = {
      x: [currentPoint.date],
      y: [currentPoint.pred],
      mode: 'markers+text',
      name: 'Selected Date',
      text: ['Selected'],
      textposition: 'top center',
      marker: { size: 12 }
    };

    const layout = {
      margin: { t: 30, r: 20, b: 50, l: 60 },
      xaxis: { title: 'Month' },
      yaxis: { title: 'Predicted Price' },
      hovermode: 'x unified'
    };

    Plotly.newPlot('forecastChart', [traceFuture, traceCurrent], layout, {responsive: true});
  </script>
</body>
</html>
